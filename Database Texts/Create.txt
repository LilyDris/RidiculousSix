CREATE TABLE Media_Item (ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, Name VARCHAR(50), Year INT, Length INT, Audiobook_Flag INT, Album_Flag INT, Publisher VARCHAR(15), Movie_Flag INT, Director VARCHAR(20), Game_Flag INT, Console VARCHAR(20), Rating VARCHAR(5), Status INT, Orders_Number INT, City VARCHAR(20) NOT NULL, State VARCHAR(20) NOT NULL, PRIMARY KEY (ID, Copy_Number), FOREIGN KEY (Orders_Number) REFERENCES Orders(Orders_Number), FOREIGN KEY (City, State) REFERENCES Branch(City,State));
CREATE TABLE Media_Genres (ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, Genres VARCHAR(20) NOT NULL, PRIMARY KEY (ID,Copy_Number, Genres), FOREIGN KEY (ID,Copy_Number) REFERENCES Media_Item(ID,Copy_Number));
CREATE TABLE Artist_Genres (Name VARCHAR(50) NOT NULL, Genres VARCHAR(20) NOT NULL, PRIMARY KEY (Name, Genres), FOREIGN KEY (Name) REFERENCES Artist(Name));
CREATE TABLE Branch (City VARCHAR(20) NOT NULL, State VARCHAR(20) NOT NULL, PRIMARY KEY (City, State));
CREATE TABLE Orders (Orders_Number INT NOT NULL, Price INT, Quantity INT, Arrival_Date DATE, City VARCHAR(20) NOT NULL, State VARCHAR(20) NOT NULL, PRIMARY KEY (Orders_Number), FOREIGN KEY (City, State) REFERENCES Branch(City,State));
CREATE TABLE Patron (Email_Address VARCHAR(50) NOT NULL, First_Name VARCHAR(20) NOT NULL, Last_Name VARCHAR(20) NOT NULL, Address VARCHAR(50), City VARCHAR(20) NOT NULL, State VARCHAR(20) NOT NULL, PRIMARY KEY (Email_Address),  FOREIGN KEY (City, State) REFERENCES Branch(City,State));
CREATE TABLE Chapter (Name VARCHAR(50) NOT NULL, Number INT NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Name, Number, Copy_Number), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID,Copy_Number));
CREATE TABLE Author (Name VARCHAR(50) NOT NULL, Age INT, PRIMARY KEY (Name));
CREATE TABLE Actor (Name VARCHAR(50) NOT NULL, Sex CHAR(1), Age INT, PRIMARY KEY (Name));
CREATE TABLE Game_Studio (Name VARCHAR(50) NOT NULL, PRIMARY KEY (Name));
CREATE TABLE Artist (Name VARCHAR(50) NOT NULL, Sex CHAR(1), AGE INT, PRIMARY KEY (Name));
CREATE TABLE Track (Name VARCHAR(50) NOT NULL, Genre VARCHAR(20), ArtistName VARCHAR(50) NOT NULL, PRIMARY KEY (Name, ArtistName), FOREIGN KEY (ArtistName) REFERENCES Artist(Name));
CREATE TABLE Author_Writes (Name VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Name, ID, Copy_Number), FOREIGN KEY (Name) REFERENCES Author(Name), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number));
CREATE TABLE Actor_Stars (Name VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Name, ID, Copy_Number), FOREIGN KEY (Name) REFERENCES Actor(Name), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number));
CREATE TABLE Studio_Creates (Name VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Name, ID, Copy_Number), FOREIGN KEY (Name) REFERENCES Game_Studio(Name), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number));
CREATE TABLE Artist_Authors (Name VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Name, ID, Copy_Number), FOREIGN KEY (Name) REFERENCES Artist(Name), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number));
CREATE TABLE Album_Contains (Name VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, ArtistName VARCHAR(50) NOT NULL, PRIMARY KEY (Name, ID, Copy_Number, ArtistName), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number), FOREIGN KEY (ArtistName,Name) REFERENCES Track(ArtistName,Name));
CREATE TABLE Checkouts (Checkout_ID CHAR(10) NOT NULL, Due_Date DATE NOT NULL, Checkout_Date Date NOT NULL, Email_Address VARCHAR(50) NOT NULL, ID CHAR(10) NOT NULL, Copy_Number INT NOT NULL, PRIMARY KEY (Checkout_ID), FOREIGN KEY (Email_Address) REFERENCES Patron(Email_Address), FOREIGN KEY (ID, Copy_Number) REFERENCES Media_Item(ID, Copy_Number));

CREATE VIEW Book_Chapters AS
SELECT Media_Item.Name, Author_Writes.Name as Author, COUNT(DISTINCT Chapter.Name) as Total_Chapters
FROM Media_Item, Author_Writes, Chapter
WHERE Author_Writes.ID=Chapter.ID AND Audiobook_Flag=1 AND Chapter.ID=Media_Item.ID
GROUP By Media_Item.Name;

CREATE VIEW Patron_Checkouts AS
SELECT First_Name, Last_Name ,COUNT(Checkout_ID) as Total_Checkedout
FROM Patron, Checkouts
Where Patron.Email_Address=Checkouts.Email_Address
GROUP BY Last_Name;
